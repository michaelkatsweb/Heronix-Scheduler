# ============================================================================
# FILE: application.properties
# LOCATION: src/main/resources/application.properties
# PURPOSE: Production configuration for Heronix Scheduling System
# ============================================================================

# ============================================================================
# APPLICATION INFO
# ============================================================================
spring.application.name=Heronix Scheduling System

# ============================================================================
# PORT CONFIGURATION (Multi-port fallback support)
# ============================================================================
# Primary port: 58080 (rare port range 58000-58999 to avoid conflicts)
# Fallback ports: 58081, 58082 configured in client.fallback-servers below
# Legacy fallback: 8080 (for backward compatibility)
server.port=58080

# ============================================================================
# DATABASE CONFIGURATION (H2 for development, PostgreSQL for production)
# ============================================================================
# Use MODE=LEGACY for H2 2.x compatibility with existing databases
# IFEXISTS=FALSE creates database if it doesn't exist
spring.datasource.url=jdbc:h2:file:./data/heronix;AUTO_SERVER=TRUE;MODE=LEGACY;IFEXISTS=FALSE
spring.datasource.driver-class-name=org.h2.Driver
# Credentials now use environment variables (see Security Configuration section below)
spring.datasource.username=${DB_USERNAME:sa}
spring.datasource.password=${DB_PASSWORD:}

# ============================================================================
# FLYWAY CONFIGURATION
# ============================================================================
# Disable Flyway - using Hibernate DDL management instead
spring.flyway.enabled=false

# ============================================================================
# JPA/HIBERNATE CONFIGURATION
# ============================================================================
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.H2Dialect
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# ============================================================================
# H2 CONSOLE (for database inspection)
# ============================================================================
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
spring.h2.console.settings.web-allow-others=false

# ============================================================================
# OPTAPLANNER AI CONFIGURATION (CRITICAL)
# ============================================================================

# Solver configuration file location
optaplanner.solver-config-xml=solverConfig.xml

# Termination configuration
optaplanner.solver.termination.spent-limit=5m
optaplanner.solver.termination.unimproved-spent-limit=60s
optaplanner.solver.termination.best-score-limit=0hard/0soft

# Environment mode (REPRODUCIBLE for debugging, FAST_ASSERT for production)
optaplanner.solver.environment-mode=FAST_ASSERT

# Daemon mode (async solving)
optaplanner.solver.daemon=true

# Solver manager configuration
optaplanner.solver-manager.parallel-solver-count=AUTO

# Move thread count (parallel move evaluation)
optaplanner.solver.move-thread-count=AUTO

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
logging.level.root=INFO
logging.level.com.heronix=INFO
logging.level.org.optaplanner=INFO
logging.level.org.springframework=INFO
logging.level.org.hibernate.SQL=WARN

# Log file configuration
logging.file.name=logs/heronix.log
logging.file.max-size=10MB
logging.file.max-history=30

# Log pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ============================================================================
# FILE UPLOAD CONFIGURATION
# ============================================================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB

# ============================================================================
# JACKSON JSON CONFIGURATION
# ============================================================================
spring.jackson.serialization.indent-output=true
spring.jackson.serialization.fail-on-empty-beans=false
spring.jackson.deserialization.fail-on-unknown-properties=false

# ============================================================================
# TRANSACTION CONFIGURATION
# ============================================================================
spring.jpa.properties.hibernate.connection.autocommit=false
spring.jpa.open-in-view=false

# ============================================================================
# THREAD POOL CONFIGURATION
# ============================================================================
spring.task.execution.pool.core-size=4
spring.task.execution.pool.max-size=16
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=heronix-

# ============================================================================
# APPLICATION-SPECIFIC SETTINGS
# ============================================================================

# Schedule generation settings
heronix.schedule.default-class-duration=50
heronix.schedule.default-break-duration=5
heronix.schedule.default-lunch-duration=30
heronix.schedule.default-start-time=08:00
heronix.schedule.default-end-time=15:00

# Import settings
heronix.import.max-batch-size=1000
heronix.import.lenient-mode=true
heronix.import.auto-generate-ids=true

# Conflict detection settings
heronix.conflict.check-teacher-conflicts=true
heronix.conflict.check-room-conflicts=true
heronix.conflict.check-student-conflicts=true
heronix.conflict.max-teacher-consecutive-hours=5

# Cache settings
spring.cache.type=simple
spring.cache.cache-names=teachers,courses,rooms,students,schedules

# ============================================================================
# PRODUCTION OVERRIDES (use application-prod.properties)
# ============================================================================
# spring.profiles.active=prod

# application.properties

# Export directory (default: ~/Heronix/Exports)
heronix.export.directory=${user.home}/Heronix/Exports

# Duty roster default times
heronix.duty.am.start=07:30
heronix.duty.am.end=08:00
heronix.duty.pm.start=15:30
heronix.duty.pm.end=16:00

# Print settings
heronix.print.default.orientation=LANDSCAPE
heronix.print.default.paperSize=LETTER

# ============================================================================
# OLLAMA AI CONFIGURATION (Local LLM)
# ============================================================================
# Enable/disable Ollama AI features
ai.ollama.enabled=true

# Ollama server URL (default: localhost)
ai.ollama.base-url=http://localhost:11434

# Default model to use (must be downloaded via: ollama pull mistral:7b-instruct)
ai.ollama.model=mistral:7b-instruct

# Request timeout in milliseconds
ai.ollama.timeout=60000

# Background analysis (automatic schedule health checks)
ai.ollama.background-analysis.enabled=true
ai.ollama.background-analysis.interval=600000

# ============================================================================
# QR CODE & FACIAL RECOGNITION ATTENDANCE SYSTEM
# ============================================================================
# System enable/disable
qr.attendance.enabled=true
facial.recognition.enabled=true

# Mock mode (for development/testing without real facial recognition API)
facial.recognition.mock.enabled=true

# Facial recognition provider (MOCK, OPENCV, AWS, AZURE, GOOGLE)
facial.recognition.provider=MOCK

# Confidence threshold for auto-verification (0.0 to 1.0)
# Higher = stricter matching, Lower = more permissive
facial.recognition.confidence.threshold=0.85

# Duplicate scan prevention window (minutes)
qr.attendance.duplicate.window.minutes=5

# Require photo capture on every scan
qr.attendance.require.photo=true

# ============================================================================
# HALL PASS SYSTEM
# ============================================================================
# Hall pass enable/disable
hall.pass.enabled=true

# Maximum allowed duration before overdue (minutes)
hall.pass.max.duration.minutes=15

# Enable overdue alerts
hall.pass.overdue.alert.enabled=true

# ============================================================================
# PERIOD TIMER SYSTEM
# ============================================================================
# Period timer enable/disable
period.timer.enabled=true

# Auto mark absent after attendance window closes
period.timer.auto.mark.absent=true

# Default attendance window from period start (minutes)
period.timer.attendance.window.minutes=15

# ============================================================================
# PARENT/STUDENT NOTIFICATION SYSTEM
# ============================================================================
# Enable parent notifications
notification.parent.enabled=true

# Enable student portal notifications
notification.student.enabled=true

# Real-time attendance notifications
notification.attendance.realtime=true

# Hall pass departure/return notifications
notification.hallpass.enabled=true

# ============================================================================
# CLIENT APPLICATION CONFIGURATION
# ============================================================================
# These settings are automatically sent to all client applications
# (EduPro-Student, EduPro-Teacher)
# Edit these once - applies to all computers automatically!

# Primary server URL (clients will connect to this)
# Using rare port 58080 to avoid conflicts with common applications
# Examples:
#   http://192.168.1.100:58080  (Local network)
#   https://heronix.school.edu  (Internet)
heronix.client.server-url=http://localhost:58080

# Fallback servers (comma-separated, optional)
# If primary fails, clients will automatically try these in order
# Port sequence: 58080 → 58081 → 58082
heronix.client.fallback-servers=http://localhost:58081,http://localhost:58082

# API base path
heronix.client.api-base-path=/api

# Connection settings
heronix.client.connection-timeout=10000
heronix.client.read-timeout=30000
heronix.client.max-retries=3
heronix.client.retry-delay=2

# Network mode (AUTO, ONLINE_ONLY, OFFLINE_ONLY, HYBRID)
# AUTO = recommended for most deployments
heronix.client.network-mode=AUTO

# Offline mode
heronix.client.offline-mode-enabled=true
heronix.client.auto-sync-enabled=true
heronix.client.sync-interval=60

# Proxy settings (if your school uses a proxy)
heronix.client.proxy-enabled=false
heronix.client.proxy-host=
heronix.client.proxy-port=0

# Security settings
heronix.client.require-https=false

# ============================================================================
# SCHOOL INFORMATION
# ============================================================================
# This information is sent to all clients

heronix.school.name=Lincoln High School
heronix.school.district=Lincoln County School District
heronix.school.code=LINCOLN_HS

# IT Department contact information
heronix.it.contact-email=it@lincolnhs.edu
heronix.it.contact-phone=(555) 123-4567

# Environment (PRODUCTION, TESTING, DEVELOPMENT)
heronix.client.environment=PRODUCTION
# ============================================================================
# ACTUATOR CONFIGURATION (Health checks and monitoring)
# ============================================================================
# Enable all actuator endpoints (Quick Win #1)
management.endpoints.web.exposure.include=health,info,metrics,prometheus,env,loggers
# Health endpoint details (always show for all users)
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
# Base path for actuator endpoints
management.endpoints.web.base-path=/actuator

# Health indicators
management.health.defaults.enabled=true
management.health.diskspace.enabled=true
management.health.db.enabled=true

# Info endpoint (enable environment property reading)
management.info.env.enabled=true
info.app.name=Heronix Scheduling System
info.app.version=1.0.0
info.app.description=AI-Powered School Scheduling System
info.app.java-version=21
info.app.build-date=2025-12-16

# Metrics configuration
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true
management.metrics.enable.http=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# Common tags for all metrics (using new observation API)
management.observations.key-values.application=${spring.application.name}
management.observations.key-values.environment=${heronix.client.environment:DEVELOPMENT}

# ============================================================================
# SECURITY CONFIGURATION (Quick Win #3 - Externalized Secrets)
# ============================================================================
# Database credentials are configured above in DATABASE CONFIGURATION section

# JWT Configuration (use environment variables in production)
jwt.secret=${JWT_SECRET_KEY:default-dev-secret-key-CHANGE-IN-PRODUCTION-minimum-256-bits}
jwt.expiration=${JWT_EXPIRATION_MS:3600000}

# Admin credentials (use environment variables in production)
admin.default.username=${ADMIN_USERNAME:admin}
admin.default.password=${ADMIN_PASSWORD:admin}

# ============================================================================
# SSL/TLS CONFIGURATION (Enable in production)
# ============================================================================
# Uncomment for HTTPS in production:
# server.ssl.enabled=true
# server.ssl.key-store=classpath:keystore.p12
# server.ssl.key-store-password=${SSL_KEY_STORE_PASSWORD}
# server.ssl.key-store-type=PKCS12
# server.ssl.key-alias=heronix

# ============================================================================
# CORS CONFIGURATION
# ============================================================================
# Allowed origins (comma-separated)
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:9590,http://localhost:58080,http://localhost:3000}
cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
cors.allowed-headers=*
cors.allow-credentials=true
cors.max-age=3600

# ============================================================================
# SPRINGDOC OPENAPI (SWAGGER UI) CONFIGURATION (Quick Win #6)
# ============================================================================
# API documentation path
springdoc.api-docs.path=/api-docs
# Swagger UI path
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
# Sort operations by HTTP method
springdoc.swagger-ui.operationsSorter=method
# Enable try-it-out by default
springdoc.swagger-ui.tryItOutEnabled=true
# API info
springdoc.api-docs.groups.enabled=true
