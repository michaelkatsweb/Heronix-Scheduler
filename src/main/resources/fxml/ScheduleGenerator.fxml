<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<!--
Schedule Generator View - AI-Powered Schedule Generation
Location: src/main/resources/fxml/ScheduleGenerator.fxml
Controller: com.eduscheduler.ui.controller.ScheduleGeneratorController

UPDATED: 2025-10-10
All fx:id attributes now match controller @FXML fields exactly
-->

<ScrollPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.eduscheduler.ui.controller.ScheduleGeneratorController"
            fitToWidth="true"
            stylesheets="@../css/dark-futuristic-theme.css"
            styleClass="root">

    <VBox spacing="20" style="-fx-padding: 20;">

        <!-- ================================================================ -->
        <!-- HEADER SECTION -->
        <!-- ================================================================ -->
        <HBox alignment="CENTER_LEFT" spacing="15" styleClass="card">
            <Label text="ðŸ¤– AI Schedule Generator" styleClass="label-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button fx:id="quickSetupButton" text="âš¡ Quick Setup" onAction="#handleQuickSetup" styleClass="button-primary">
                <tooltip>
                    <Tooltip text="Apply default configuration for quick start"/>
                </tooltip>
            </Button>
        </HBox>

        <!-- ================================================================ -->
        <!-- CONFIGURATION SECTION -->
        <!-- ================================================================ -->
        <VBox spacing="15" styleClass="card">
            <Label text="âš™ï¸ Schedule Configuration" styleClass="label-subtitle" style="-fx-font-size: 18px;"/>

            <Separator/>

            <!-- Schedule Name -->
            <VBox spacing="5">
                <Label text="Schedule Name:" styleClass="label" style="-fx-font-weight: bold;"/>
                <TextField fx:id="scheduleNameField" 
                          promptText="e.g., Fall 2025 Master Schedule"
                          prefWidth="400"
                          style="-fx-font-size: 14px;">
                    <tooltip>
                        <Tooltip text="Enter a descriptive name for this schedule"/>
                    </tooltip>
                </TextField>
            </VBox>

            <!-- Schedule Type -->
            <VBox spacing="5">
                <Label text="Schedule Type:" styleClass="label" style="-fx-font-weight: bold;"/>
                <ComboBox fx:id="scheduleTypeComboBox" 
                         prefWidth="300"
                         style="-fx-font-size: 14px;">
                    <tooltip>
                        <Tooltip text="Select the type of schedule to generate"/>
                    </tooltip>
                </ComboBox>
                <Label text="Choose the scheduling model that fits your institution"
                       styleClass="label-caption"/>
            </VBox>

            <!-- Date Range -->
            <HBox spacing="20">
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Start Date:" styleClass="label" style="-fx-font-weight: bold;"/>
                    <DatePicker fx:id="startDatePicker" prefWidth="200" style="-fx-font-size: 14px;">
                        <tooltip>
                            <Tooltip text="First day of the schedule"/>
                        </tooltip>
                    </DatePicker>
                </VBox>

                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="End Date:" styleClass="label" style="-fx-font-weight: bold;"/>
                    <DatePicker fx:id="endDatePicker" prefWidth="200" style="-fx-font-size: 14px;">
                        <tooltip>
                            <Tooltip text="Last day of the schedule"/>
                        </tooltip>
                    </DatePicker>
                </VBox>
            </HBox>

            <Separator/>

            <!-- Time Configuration -->
            <Label text="â° Time Configuration"
                   style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>

            <GridPane hgap="20" vgap="15">
                <!-- School Hours -->
                <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                    <Label text="School Start Hour:" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Spinner fx:id="startHourSpinner" prefWidth="120" editable="true" style="-fx-font-size: 14px;"/>
                </VBox>

                <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                    <Label text="School End Hour:" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Spinner fx:id="endHourSpinner" prefWidth="120" editable="true" style="-fx-font-size: 14px;"/>
                </VBox>

                <!-- Period Duration -->
                <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1">
                    <Label text="Period Duration (min):" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Spinner fx:id="periodDurationSpinner" prefWidth="120" editable="true" style="-fx-font-size: 14px;"/>
                </VBox>
            </GridPane>

            <Separator style="-fx-padding: 10 0;"/>

            <!-- Minute-Precise Time Configuration -->
            <Label text="â° Time Configuration (Minute-Precise)"
                   style="-fx-font-size: 15; -fx-font-weight: bold;"/>

            <GridPane hgap="20" vgap="15">
                <!-- School Start Time (Breakfast/Arrival) -->
                <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                    <Label text="School Start Time:" styleClass="label" style="-fx-font-weight: bold;"/>
                    <TextField fx:id="schoolStartTimeField"
                              promptText="07:00"
                              prefWidth="120"
                              style="-fx-font-size: 14;">
                        <tooltip>
                            <Tooltip text="Format: HH:MM (24-hour), e.g., 07:00 for 7:00 AM (breakfast/arrival)"/>
                        </tooltip>
                    </TextField>
                    <Label text="e.g., 07:00 (breakfast/arrival)" styleClass="label-caption"/>
                </VBox>

                <!-- First Period Start Time -->
                <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                    <Label text="First Period Start Time:" styleClass="label" style="-fx-font-weight: bold;"/>
                    <TextField fx:id="firstPeriodStartTimeField"
                              promptText="07:20"
                              prefWidth="120"
                              style="-fx-font-size: 14;">
                        <tooltip>
                            <Tooltip text="Format: HH:MM (24-hour), e.g., 07:20 for 7:20 AM"/>
                        </tooltip>
                    </TextField>
                    <Label text="e.g., 07:20 (classes start)" styleClass="label-caption"/>
                </VBox>

                <!-- School End Time -->
                <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1">
                    <Label text="School End Time:" styleClass="label" style="-fx-font-weight: bold;"/>
                    <TextField fx:id="schoolEndTimeField"
                              promptText="14:10"
                              prefWidth="120"
                              style="-fx-font-size: 14;">
                        <tooltip>
                            <Tooltip text="Format: HH:MM (24-hour), e.g., 14:10 for 2:10 PM"/>
                        </tooltip>
                    </TextField>
                    <Label text="e.g., 14:10 (school ends)" styleClass="label-caption"/>
                </VBox>

                <!-- Lunch Start Time -->
                <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1">
                    <Label text="Lunch Start Time:" styleClass="label" style="-fx-font-weight: bold;"/>
                    <TextField fx:id="lunchStartTimeField"
                              promptText="10:50"
                              prefWidth="120"
                              style="-fx-font-size: 14;">
                        <tooltip>
                            <Tooltip text="Format: HH:MM (24-hour), e.g., 10:50 for 10:50 AM"/>
                        </tooltip>
                    </TextField>
                    <Label text="e.g., 10:50 (lunch period)" styleClass="label-caption"/>
                </VBox>

                <!-- Passing Period Duration (Phase 2) -->
                <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="2">
                    <Label text="Passing Period (min):" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Spinner fx:id="passingPeriodSpinner" prefWidth="120" editable="true" style="-fx-font-size: 14;">
                        <tooltip>
                            <Tooltip text="Time between classes for student movement (typically 4-5 minutes)"/>
                        </tooltip>
                    </Spinner>
                    <Label text="Time between classes" styleClass="label-caption"/>
                </VBox>

                <!-- Lunch Duration -->
                <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="2">
                    <Label text="Lunch Duration (min):" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Spinner fx:id="lunchDurationSpinner" prefWidth="120" editable="true" style="-fx-font-size: 14px;"/>
                    <Label text="Typically 30 minutes" styleClass="label-caption"/>
                </VBox>
            </GridPane>

            <!-- Lunch Configuration -->
            <HBox spacing="10" alignment="CENTER_LEFT">
                <CheckBox fx:id="enableLunchCheckBox" text="Enable Lunch Period" 
                         styleClass="label" style="-fx-font-weight: bold;"/>
                <Label text="Start Hour:"/>
                <Spinner fx:id="lunchStartHourSpinner" prefWidth="100" editable="true"/>
            </HBox>

            <Separator/>

            <!-- Teacher Constraints -->
            <Label text="ðŸ‘¥ Teacher Constraints"
                   style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>

            <GridPane hgap="20" vgap="15">
                <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                    <Label text="Max Consecutive Hours:" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Spinner fx:id="maxConsecutiveHoursSpinner" prefWidth="120" editable="true"/>
                    <Label text="Prevent teacher burnout" styleClass="label-caption"/>
                </VBox>

                <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                    <Label text="Max Daily Hours:" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Spinner fx:id="maxDailyHoursSpinner" prefWidth="120" editable="true"/>
                    <Label text="Total teaching hours per day" styleClass="label-caption"/>
                </VBox>
            </GridPane>

            <Separator/>

            <!-- AI Optimization Settings -->
            <Label text="ðŸ§  AI Optimization Settings"
                   style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>

            <VBox spacing="5">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="Optimization Time:" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Label fx:id="optimizationTimeLabel" text="2 min 0 sec"
                           style="-fx-text-fill: #3498db; -fx-font-weight: bold; -fx-font-size: 14px;"/>
                </HBox>
                <Slider fx:id="optimizationTimeSlider" 
                       min="30" max="600" value="120"
                       showTickLabels="true" showTickMarks="true" 
                       majorTickUnit="60" minorTickCount="5" 
                       snapToTicks="false"
                       prefWidth="500"/>
                <Label text="Longer time = better optimization (recommended: 2-5 minutes)"
                       styleClass="label-caption"/>
            </VBox>
        </VBox>

        <!-- ================================================================ -->
        <!-- RESOURCE VALIDATION SECTION -->
        <!-- ================================================================ -->
        <VBox spacing="15"
              styleClass="card" style=" -fx-padding: 20; -fx-background-radius: 8; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">

            <HBox alignment="CENTER_LEFT" spacing="10">
                <Label text="ðŸ“Š Available Resources"
                       styleClass="label-subtitle" style="-fx-font-size: 18px;"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Button fx:id="refreshResourcesButton" text="ðŸ”„ Refresh" onAction="#handleRefreshResources"
                        styleClass="button">
                    <tooltip>
                        <Tooltip text="Reload resource counts from database"/>
                    </tooltip>
                </Button>
            </HBox>

            <Separator/>

            <!-- Resource Counts Grid -->
            <GridPane hgap="20" vgap="15">
                <!-- Teachers -->
                <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0"
                      styleClass="stat-card" style=" -fx-padding: 15; -fx-background-radius: 5;">
                    <Label text="ðŸ‘¨â€ðŸ« Teachers" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Label fx:id="teacherCountLabel" text="0"
                           style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #3498db;"/>
                    <Label text="Available" styleClass="label-caption"/>
                </VBox>

                <!-- Courses -->
                <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0"
                      styleClass="stat-card" style=" -fx-padding: 15; -fx-background-radius: 5;">
                    <Label text="ðŸ“š Courses" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Label fx:id="courseCountLabel" text="0"
                           style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #9b59b6;"/>
                    <Label text="Available" styleClass="label-caption"/>
                </VBox>

                <!-- Rooms -->
                <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0"
                      styleClass="stat-card" style=" -fx-padding: 15; -fx-background-radius: 5;">
                    <Label text="ðŸ« Rooms" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Label fx:id="roomCountLabel" text="0"
                           style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
                    <Label text="Available" styleClass="label-caption"/>
                </VBox>

                <!-- Students -->
                <VBox spacing="5" GridPane.columnIndex="3" GridPane.rowIndex="0"
                      styleClass="stat-card" style=" -fx-padding: 15; -fx-background-radius: 5;">
                    <Label text="ðŸ‘¨â€ðŸŽ“ Students" styleClass="label" style="-fx-font-weight: bold;"/>
                    <Label fx:id="studentCountLabel" text="0"
                           style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #e74c3c;"/>
                    <Label text="Enrolled" styleClass="label-caption"/>
                </VBox>
            </GridPane>

            <!-- Validation Messages -->
            <VBox fx:id="validationMessagesBox" spacing="5" style="-fx-padding: 10; -fx-background-color: #f8f9fa; -fx-background-radius: 5;">
                <!-- Validation messages will be added dynamically -->
            </VBox>
        </VBox>

        <!-- ================================================================ -->
        <!-- GENERATION SECTION -->
        <!-- ================================================================ -->
        <VBox spacing="15"
              styleClass="card" style=" -fx-padding: 30; -fx-background-radius: 8; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">

            <Label text="ðŸš€ Generate Schedule"
                   styleClass="label-subtitle" style="-fx-font-size: 18px;"/>

            <Separator/>

            <!-- Action Buttons -->
            <HBox spacing="15" alignment="CENTER">
                <Button fx:id="generateButton" text="ðŸš€ Generate Schedule" onAction="#handleGenerate"
                        styleClass="button-success" style="-fx-font-size: 18px; -fx-padding: 15 40;"
                        defaultButton="true">
                    <tooltip>
                        <Tooltip text="Start AI-powered schedule generation"/>
                    </tooltip>
                </Button>

                <Button fx:id="cancelButton" text="âŒ Cancel" onAction="#handleCancel"
                        disable="true"
                        styleClass="button-danger" style="-fx-font-size: 16px; -fx-padding: 15 30;">
                    <tooltip>
                        <Tooltip text="Cancel generation in progress"/>
                    </tooltip>
                </Button>
            </HBox>

            <!-- Progress Bar -->
            <ProgressBar fx:id="generationProgressBar" prefWidth="600" progress="0"
                        visible="true" 
                        style="-fx-accent: #27ae60;"/>

            <!-- Status Label -->
            <Label fx:id="generationStatusLabel" text="Ready to generate schedule"
                   style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;" 
                   alignment="CENTER" textAlignment="CENTER"/>

            <Separator/>

            <!-- Generation Log -->
            <VBox spacing="5">
                <Label text="ðŸ“ Generation Log:" styleClass="label" style="-fx-font-weight: bold;"/>
                <TextArea fx:id="generationLogArea" 
                         prefRowCount="8" 
                         editable="false"
                         wrapText="true"
                         style="-fx-control-inner-background: #2c3e50; -fx-text-fill: #ecf0f1; -fx-font-family: 'Courier New'; -fx-font-size: 12px;"/>
            </VBox>
        </VBox>

        <!-- ================================================================ -->
        <!-- RESULTS SECTION (Hidden Initially) -->
        <!-- ================================================================ -->
        <VBox fx:id="resultsPanel" spacing="15" visible="false" managed="false"
              styleClass="card" style=" -fx-padding: 20; -fx-background-radius: 8; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">

            <Label text="âœ… Schedule Generated Successfully!"
                   style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>

            <Separator/>

            <!-- Results Metrics Grid -->
            <GridPane hgap="30" vgap="20">
                <!-- Optimization Score -->
                <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0"
                      styleClass="stat-card" style=" -fx-padding: 20; -fx-background-radius: 8; -fx-alignment: center;">
                    <Label text="Optimization Score" 
                           style="-fx-font-weight: bold; -fx-text-fill: #34495e; -fx-font-size: 14px;"/>
                    <Label fx:id="optimizationScoreLabel" text="0.0%"
                           style="-fx-font-size: 32px; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
                </VBox>

                <!-- Assignment Rate -->
                <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0"
                      styleClass="stat-card" style=" -fx-padding: 20; -fx-background-radius: 8; -fx-alignment: center;">
                    <Label text="Assignment Rate" 
                           style="-fx-font-weight: bold; -fx-text-fill: #34495e; -fx-font-size: 14px;"/>
                    <Label fx:id="assignmentRateLabel" text="0.0%"
                           style="-fx-font-size: 32px; -fx-font-weight: bold; -fx-text-fill: #3498db;"/>
                </VBox>

                <!-- Conflicts -->
                <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0"
                      styleClass="stat-card" style=" -fx-padding: 20; -fx-background-radius: 8; -fx-alignment: center;">
                    <Label text="Conflicts" 
                           style="-fx-font-weight: bold; -fx-text-fill: #34495e; -fx-font-size: 14px;"/>
                    <Label fx:id="conflictCountLabel" text="0"
                           style="-fx-font-size: 32px; -fx-font-weight: bold; -fx-text-fill: #e74c3c;"/>
                </VBox>

                <!-- Teacher Utilization -->
                <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1"
                      styleClass="stat-card" style=" -fx-padding: 20; -fx-background-radius: 8; -fx-alignment: center;">
                    <Label text="Teacher Utilization" 
                           style="-fx-font-weight: bold; -fx-text-fill: #34495e; -fx-font-size: 14px;"/>
                    <Label fx:id="teacherUtilizationLabel" text="0.0%"
                           style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #9b59b6;"/>
                </VBox>

                <!-- Room Utilization -->
                <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1"
                      styleClass="stat-card" style=" -fx-padding: 20; -fx-background-radius: 8; -fx-alignment: center;">
                    <Label text="Room Utilization" 
                           style="-fx-font-weight: bold; -fx-text-fill: #34495e; -fx-font-size: 14px;"/>
                    <Label fx:id="roomUtilizationLabel" text="0.0%"
                           style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: #f39c12;"/>
                </VBox>
            </GridPane>

            <Separator/>

            <!-- Results Summary -->
            <VBox spacing="5">
                <Label text="ðŸ“Š Detailed Summary:" style="-fx-font-weight: bold; -fx-text-fill: #34495e; -fx-font-size: 16px;"/>
                <TextArea fx:id="resultsSummaryArea" 
                         prefRowCount="15" 
                         editable="false"
                         wrapText="true"
                         style="-fx-control-inner-background: #f8f9fa; -fx-font-family: 'Courier New'; -fx-font-size: 12px;"/>
            </VBox>

            <Separator/>

            <!-- Action Buttons -->
            <HBox spacing="15" alignment="CENTER">
                <Button fx:id="saveDraftButton" text="ðŸ’¾ Save Draft" onAction="#handleSaveDraft"
                        style="-fx-background-color: #95a5a6; -fx-text-fill: white; -fx-padding: 12 25; -fx-cursor: hand; -fx-background-radius: 5; -fx-font-weight: bold;">
                    <tooltip>
                        <Tooltip text="Save schedule as draft"/>
                    </tooltip>
                </Button>

                <Button fx:id="publishButton" text="ðŸ“¢ Publish Schedule" onAction="#handlePublish"
                        styleClass="button-success">
                    <tooltip>
                        <Tooltip text="Publish schedule to make it visible to all users"/>
                    </tooltip>
                </Button>

                <Button fx:id="reOptimizeButton" text="ðŸ”„ Re-Optimize" onAction="#handleReOptimize"
                        styleClass="button-primary">
                    <tooltip>
                        <Tooltip text="Run optimization again with extended time"/>
                    </tooltip>
                </Button>

                <Button fx:id="viewScheduleButton" text="ðŸ‘ï¸ View Schedule" onAction="#handleViewSchedule"
                        styleClass="button-primary">
                    <tooltip>
                        <Tooltip text="Open schedule in calendar viewer"/>
                    </tooltip>
                </Button>
            </HBox>
        </VBox>

    </VBox>

</ScrollPane>