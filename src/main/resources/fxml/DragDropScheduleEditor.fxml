<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<!--
Drag-Drop Schedule Editor
Visual schedule editor with drag-and-drop functionality for intuitive schedule modifications

Location: src/main/resources/fxml/DragDropScheduleEditor.fxml
-->

<BorderPane xmlns="http://javafx.com/javafx/17"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.eduscheduler.ui.controller.DragDropScheduleEditorController"
            styleClass="main-container">

    <!-- HEADER -->
    <top>
        <VBox styleClass="header-section">
            <HBox alignment="CENTER_LEFT" spacing="20" styleClass="page-header">
                <Label text="âœï¸ Drag &amp; Drop Schedule Editor" styleClass="page-title"/>
                <Region HBox.hgrow="ALWAYS"/>

                <!-- Edit Mode Toggle -->
                <ToggleButton fx:id="editModeToggle" text="ðŸ”“ Edit Mode" onAction="#handleEditModeToggle"
                              styleClass="toggle-button"/>

                <!-- Undo/Redo -->
                <Button fx:id="undoButton" text="â†¶ Undo" onAction="#handleUndo"
                        styleClass="button-secondary" disable="true"/>
                <Button fx:id="redoButton" text="â†· Redo" onAction="#handleRedo"
                        styleClass="button-secondary" disable="true"/>

                <Separator orientation="VERTICAL"/>

                <!-- Actions -->
                <Button text="ðŸ”„ Refresh" onAction="#handleRefresh" styleClass="button-secondary"/>
                <Button text="ðŸ’¾ Save Changes" onAction="#handleSaveChanges" styleClass="button-primary"/>
                <Button text="âŒ Discard" onAction="#handleDiscardChanges" styleClass="button-secondary"/>
            </HBox>

            <!-- Status Bar -->
            <HBox alignment="CENTER_LEFT" spacing="15" styleClass="status-bar"
                  style="-fx-background-color: #f5f5f5; -fx-padding: 10;">
                <Label fx:id="editModeStatusLabel" text="ðŸ“Œ View Mode" styleClass="status-label"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="changesStatusLabel" text="No unsaved changes" styleClass="status-label"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="conflictsStatusLabel" text="No conflicts detected" styleClass="status-label"/>
            </HBox>
        </VBox>
    </top>

    <!-- MAIN CONTENT -->
    <center>
        <SplitPane dividerPositions="0.75" styleClass="split-pane">

            <!-- LEFT: Schedule Grid -->
            <ScrollPane fitToWidth="true" fitToHeight="true" styleClass="scroll-pane">
                <VBox spacing="10" styleClass="content-container">
                    <padding>
                        <Insets top="10" right="10" bottom="10" left="10"/>
                    </padding>

                    <!-- Filters -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <Label text="Filters:" styleClass="filter-label"/>
                        <ComboBox fx:id="teacherFilterComboBox" promptText="All Teachers"
                                  onAction="#handleFilterChange" prefWidth="150"/>
                        <ComboBox fx:id="roomFilterComboBox" promptText="All Rooms"
                                  onAction="#handleFilterChange" prefWidth="150"/>
                        <ComboBox fx:id="gradeFilterComboBox" promptText="All Grades"
                                  onAction="#handleFilterChange" prefWidth="120"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <CheckBox fx:id="showConflictsCheckbox" text="Highlight Conflicts"
                                  onAction="#handleShowConflictsToggle" selected="true"/>
                    </HBox>

                    <Separator/>

                    <!-- Schedule Grid Container -->
                    <VBox fx:id="scheduleGridContainer" spacing="0" styleClass="schedule-grid-container">
                        <!-- Dynamic grid will be generated here -->
                        <GridPane fx:id="scheduleGrid" hgap="2" vgap="2" styleClass="schedule-grid">
                            <!-- Grid populated dynamically -->
                        </GridPane>
                    </VBox>
                </VBox>
            </ScrollPane>

            <!-- RIGHT: Details Panel -->
            <VBox spacing="15" styleClass="details-panel" style="-fx-background-color: #fafafa; -fx-padding: 15;">

                <!-- Selected Section Details -->
                <VBox spacing="10" styleClass="card">
                    <Label text="ðŸ“‹ Selected Section" styleClass="section-title"/>

                    <VBox fx:id="sectionDetailsContainer" spacing="8">
                        <Label fx:id="noSelectionLabel" text="Click a section to view details"
                               styleClass="stat-description"/>

                        <!-- Details shown when section is selected -->
                        <VBox fx:id="sectionDetailsBox" spacing="8" visible="false" managed="false">
                            <HBox spacing="10">
                                <Label text="Course:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailCourseLabel" text="--" styleClass="detail-value"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Section:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailSectionLabel" text="--" styleClass="detail-value"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Teacher:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailTeacherLabel" text="--" styleClass="detail-value"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Room:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailRoomLabel" text="--" styleClass="detail-value"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Period:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailPeriodLabel" text="--" styleClass="detail-value"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Enrollment:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailEnrollmentLabel" text="--" styleClass="detail-value"/>
                            </HBox>

                            <Separator/>

                            <!-- Quick Actions -->
                            <VBox spacing="8">
                                <Label text="Quick Actions:" styleClass="stat-label"/>
                                <Button text="ðŸ”„ Swap Teacher" onAction="#handleSwapTeacher"
                                        prefWidth="200" styleClass="button-secondary"/>
                                <Button text="ðŸ« Swap Room" onAction="#handleSwapRoom"
                                        prefWidth="200" styleClass="button-secondary"/>
                                <Button text="â° Change Period" onAction="#handleChangePeriod"
                                        prefWidth="200" styleClass="button-secondary"/>
                                <Button text="âŒ Unassign Section" onAction="#handleUnassignSection"
                                        prefWidth="200" styleClass="button-warning"/>
                            </VBox>
                        </VBox>
                    </VBox>
                </VBox>

                <!-- Conflict Warnings -->
                <VBox spacing="10" styleClass="card" style="-fx-background-color: #fff3cd;">
                    <Label text="âš ï¸ Conflicts" styleClass="section-title"/>
                    <ListView fx:id="conflictsList" prefHeight="150" styleClass="conflict-list">
                        <placeholder>
                            <Label text="âœ“ No conflicts detected"/>
                        </placeholder>
                    </ListView>
                </VBox>

                <!-- Recent Changes -->
                <VBox spacing="10" styleClass="card">
                    <Label text="ðŸ“ Recent Changes" styleClass="section-title"/>
                    <ListView fx:id="recentChangesList" prefHeight="150" styleClass="changes-list">
                        <placeholder>
                            <Label text="No changes yet"/>
                        </placeholder>
                    </ListView>
                </VBox>

                <!-- Suggestions -->
                <VBox spacing="10" styleClass="card" style="-fx-background-color: #d1ecf1;">
                    <Label text="ðŸ’¡ Smart Suggestions" styleClass="section-title"/>
                    <VBox fx:id="suggestionsContainer" spacing="5">
                        <Label text="Analyzing schedule..." styleClass="stat-description"/>
                    </VBox>
                </VBox>

            </VBox>

        </SplitPane>
    </center>

    <!-- BOTTOM: Legend & Help -->
    <bottom>
        <HBox spacing="20" alignment="CENTER_LEFT" styleClass="footer-section"
              style="-fx-background-color: #f8f9fa; -fx-padding: 10;">
            <Label text="Legend:" styleClass="legend-label"/>

            <HBox spacing="5" alignment="CENTER_LEFT">
                <Region prefWidth="15" prefHeight="15" style="-fx-background-color: #e3f2fd; -fx-border-color: #2196f3;"/>
                <Label text="Normal" styleClass="legend-text"/>
            </HBox>

            <HBox spacing="5" alignment="CENTER_LEFT">
                <Region prefWidth="15" prefHeight="15" style="-fx-background-color: #ffebee; -fx-border-color: #f44336;"/>
                <Label text="Conflict" styleClass="legend-text"/>
            </HBox>

            <HBox spacing="5" alignment="CENTER_LEFT">
                <Region prefWidth="15" prefHeight="15" style="-fx-background-color: #fff9c4; -fx-border-color: #fbc02d;"/>
                <Label text="Modified" styleClass="legend-text"/>
            </HBox>

            <HBox spacing="5" alignment="CENTER_LEFT">
                <Region prefWidth="15" prefHeight="15" style="-fx-background-color: #f5f5f5; -fx-border-color: #9e9e9e; -fx-border-style: dashed;"/>
                <Label text="Empty" styleClass="legend-text"/>
            </HBox>

            <Region HBox.hgrow="ALWAYS"/>

            <Label text="ðŸ’¡ Tip: Drag sections to move them. Ctrl+Z to undo." styleClass="help-text"
                   style="-fx-font-style: italic; -fx-text-fill: #666;"/>
        </HBox>
    </bottom>

</BorderPane>
