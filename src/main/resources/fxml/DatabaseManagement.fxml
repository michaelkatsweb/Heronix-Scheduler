<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<!--
    Database Management Panel - Admin Tool
    Provides integrated database management for H2 and PostgreSQL
    Location: src/main/resources/fxml/DatabaseManagement.fxml
-->
<VBox xmlns="http://javafx.com/javafx"
      xmlns:fx="http://javafx.com/fxml"
      fx:controller="com.eduscheduler.ui.controller.DatabaseManagementController"
      spacing="20"
      styleClass="content-pane">

    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <!-- Header -->
    <HBox alignment="CENTER_LEFT" spacing="15">
        <Label text="ðŸ—„ï¸" style="-fx-font-size: 32;"/>
        <VBox>
            <Label text="Database Management" styleClass="header-title"
                   style="-fx-font-size: 24; -fx-font-weight: bold;"/>
            <Label text="Manage database connections, console access, and maintenance operations"
                   styleClass="header-subtitle" style="-fx-text-fill: #666;"/>
        </VBox>
    </HBox>

    <Separator/>

    <!-- Main Content in ScrollPane -->
    <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS"
                style="-fx-background-color: transparent; -fx-border-color: transparent;">
        <VBox spacing="25">
            <padding>
                <Insets top="10" right="10" bottom="10" left="10"/>
            </padding>

            <!-- Database Connection Info Card -->
            <VBox spacing="10" styleClass="card"
                  style="-fx-background-color: white; -fx-background-radius: 8; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="ðŸ“Š" style="-fx-font-size: 20;"/>
                    <Label text="Current Database Connection" styleClass="section-title"
                           style="-fx-font-size: 18; -fx-font-weight: bold;"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Label fx:id="connectionStatusLabel" text="â— Connected"
                           style="-fx-text-fill: #4CAF50; -fx-font-weight: bold;"/>
                </HBox>

                <Separator/>

                <GridPane hgap="15" vgap="12">
                    <columnConstraints>
                        <ColumnConstraints minWidth="150" prefWidth="150"/>
                        <ColumnConstraints hgrow="ALWAYS"/>
                    </columnConstraints>

                    <Label text="Database Type:" GridPane.columnIndex="0" GridPane.rowIndex="0"
                           style="-fx-font-weight: bold;"/>
                    <Label fx:id="dbTypeLabel" text="H2 Database" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                    <Label text="JDBC URL:" GridPane.columnIndex="0" GridPane.rowIndex="1"
                           style="-fx-font-weight: bold;"/>
                    <HBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="1" alignment="CENTER_LEFT">
                        <TextField fx:id="jdbcUrlField" editable="false" HBox.hgrow="ALWAYS"
                                   style="-fx-background-color: #f5f5f5;"/>
                        <Button text="ðŸ“‹ Copy" onAction="#handleCopyJdbcUrl"
                                style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-cursor: hand;"/>
                    </HBox>

                    <Label text="Username:" GridPane.columnIndex="0" GridPane.rowIndex="2"
                           style="-fx-font-weight: bold;"/>
                    <Label fx:id="usernameLabel" text="sa" GridPane.columnIndex="1" GridPane.rowIndex="2"/>

                    <Label text="Database Size:" GridPane.columnIndex="0" GridPane.rowIndex="3"
                           style="-fx-font-weight: bold;"/>
                    <Label fx:id="dbSizeLabel" text="Calculating..." GridPane.columnIndex="1" GridPane.rowIndex="3"/>

                    <Label text="Total Tables:" GridPane.columnIndex="0" GridPane.rowIndex="4"
                           style="-fx-font-weight: bold;"/>
                    <Label fx:id="tableCountLabel" text="Loading..." GridPane.columnIndex="1" GridPane.rowIndex="4"/>

                    <Label text="Last Backup:" GridPane.columnIndex="0" GridPane.rowIndex="5"
                           style="-fx-font-weight: bold;"/>
                    <Label fx:id="lastBackupLabel" text="Never" GridPane.columnIndex="1" GridPane.rowIndex="5"
                           style="-fx-text-fill: #FF9800;"/>
                </GridPane>
            </VBox>

            <!-- H2 Console Access Card -->
            <VBox spacing="15" styleClass="card"
                  style="-fx-background-color: white; -fx-background-radius: 8; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="ðŸ–¥ï¸" style="-fx-font-size: 20;"/>
                    <Label text="H2 Database Console" styleClass="section-title"
                           style="-fx-font-size: 18; -fx-font-weight: bold;"/>
                </HBox>

                <Separator/>

                <Label text="Access the H2 web console for direct SQL queries and database inspection"
                       wrapText="true" style="-fx-text-fill: #666;"/>

                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Label text="Console Status:" style="-fx-font-weight: bold;"/>
                    <Label fx:id="h2ConsoleStatusLabel" text="â— Stopped"
                           style="-fx-text-fill: #F44336;"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <Label fx:id="h2ConsoleUrlLabel" text="" style="-fx-text-fill: #2196F3; -fx-underline: true;"/>
                </HBox>

                <HBox spacing="10">
                    <Button fx:id="startH2ConsoleBtn" text="ðŸš€ Start H2 Console" onAction="#handleStartH2Console"
                            styleClass="button-primary"
                            style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-padding: 10 20; -fx-cursor: hand; -fx-font-weight: bold;"/>
                    <Button fx:id="stopH2ConsoleBtn" text="â¹ï¸ Stop H2 Console" onAction="#handleStopH2Console"
                            disable="true"
                            style="-fx-background-color: #F44336; -fx-text-fill: white; -fx-padding: 10 20; -fx-cursor: hand;"/>
                    <Button text="ðŸŒ Open in Browser" onAction="#handleOpenH2InBrowser"
                            fx:id="openH2BrowserBtn" disable="true"
                            style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-padding: 10 20; -fx-cursor: hand;"/>
                </HBox>

                <TextArea fx:id="h2ConsoleLogArea" editable="false" wrapText="true"
                          prefRowCount="4" style="-fx-background-color: #f5f5f5; -fx-font-family: monospace; -fx-font-size: 11;"/>
            </VBox>

            <!-- PostgreSQL Tools Card -->
            <VBox spacing="15" styleClass="card"
                  style="-fx-background-color: white; -fx-background-radius: 8; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="ðŸ˜" style="-fx-font-size: 20;"/>
                    <VBox>
                        <Label text="PostgreSQL Database (Future)" styleClass="section-title"
                               style="-fx-font-size: 18; -fx-font-weight: bold;"/>
                        <Label text="Ready for production deployment"
                               style="-fx-text-fill: #666; -fx-font-size: 12;"/>
                    </VBox>
                </HBox>

                <Separator/>

                <Label text="PostgreSQL connection settings and pgAdmin integration"
                       wrapText="true" style="-fx-text-fill: #666;"/>

                <GridPane hgap="15" vgap="12">
                    <columnConstraints>
                        <ColumnConstraints minWidth="150" prefWidth="150"/>
                        <ColumnConstraints hgrow="ALWAYS"/>
                    </columnConstraints>

                    <Label text="Host:" GridPane.columnIndex="0" GridPane.rowIndex="0"
                           style="-fx-font-weight: bold;"/>
                    <TextField fx:id="pgHostField" promptText="localhost" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                    <Label text="Port:" GridPane.columnIndex="0" GridPane.rowIndex="1"
                           style="-fx-font-weight: bold;"/>
                    <TextField fx:id="pgPortField" promptText="5432" GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                    <Label text="Database:" GridPane.columnIndex="0" GridPane.rowIndex="2"
                           style="-fx-font-weight: bold;"/>
                    <TextField fx:id="pgDatabaseField" promptText="eduscheduler" GridPane.columnIndex="1" GridPane.rowIndex="2"/>

                    <Label text="Username:" GridPane.columnIndex="0" GridPane.rowIndex="3"
                           style="-fx-font-weight: bold;"/>
                    <TextField fx:id="pgUsernameField" promptText="postgres" GridPane.columnIndex="1" GridPane.rowIndex="3"/>

                    <Label text="Password:" GridPane.columnIndex="0" GridPane.rowIndex="4"
                           style="-fx-font-weight: bold;"/>
                    <PasswordField fx:id="pgPasswordField" GridPane.columnIndex="1" GridPane.rowIndex="4"/>
                </GridPane>

                <HBox spacing="10">
                    <Button text="ðŸ”Œ Test PostgreSQL Connection" onAction="#handleTestPostgreSQL"
                            style="-fx-background-color: #336791; -fx-text-fill: white; -fx-padding: 10 20; -fx-cursor: hand;"/>
                    <Button text="ðŸ’¾ Save PostgreSQL Config" onAction="#handleSavePostgreSQLConfig"
                            style="-fx-background-color: #4CAF50; -fx-text-fill: white; -fx-padding: 10 20; -fx-cursor: hand;"/>
                    <Button text="ðŸ”„ Switch to PostgreSQL" onAction="#handleSwitchToPostgreSQL"
                            style="-fx-background-color: #FF9800; -fx-text-fill: white; -fx-padding: 10 20; -fx-cursor: hand;"/>
                </HBox>

                <Label fx:id="pgStatusLabel" text="" wrapText="true" style="-fx-font-weight: bold;"/>
            </VBox>

            <!-- Database Maintenance Card -->
            <VBox spacing="15" styleClass="card"
                  style="-fx-background-color: white; -fx-background-radius: 8; -fx-padding: 20; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="ðŸ”§" style="-fx-font-size: 20;"/>
                    <Label text="Database Maintenance" styleClass="section-title"
                           style="-fx-font-size: 18; -fx-font-weight: bold;"/>
                </HBox>

                <Separator/>

                <!-- Backup/Restore -->
                <VBox spacing="10">
                    <Label text="Backup &amp; Restore" style="-fx-font-weight: bold; -fx-font-size: 14;"/>
                    <HBox spacing="10">
                        <Button text="ðŸ’¾ Backup Database" onAction="#handleBackupDatabase"
                                style="-fx-background-color: #2196F3; -fx-text-fill: white; -fx-padding: 10 20; -fx-cursor: hand;"/>
                        <Button text="ðŸ“‚ Restore from Backup" onAction="#handleRestoreDatabase"
                                style="-fx-background-color: #FF9800; -fx-text-fill: white; -fx-padding: 10 20; -fx-cursor: hand;"/>
                        <Button text="ðŸ“ Open Backup Folder" onAction="#handleOpenBackupFolder"
                                style="-fx-padding: 10 20; -fx-cursor: hand;"/>
                    </HBox>
                    <Label fx:id="backupStatusLabel" text="" wrapText="true" style="-fx-text-fill: #666;"/>
                </VBox>

                <Separator/>

                <!-- Data Management -->
                <VBox spacing="10">
                    <Label text="Data Management" style="-fx-font-weight: bold; -fx-font-size: 14;"/>
                    <HBox spacing="10">
                        <Button text="ðŸ“Š View Database Stats" onAction="#handleViewStats"
                                style="-fx-background-color: #9C27B0; -fx-text-fill: white; -fx-padding: 10 20; -fx-cursor: hand;"/>
                        <Button text="ðŸ” Analyze Tables" onAction="#handleAnalyzeTables"
                                style="-fx-padding: 10 20; -fx-cursor: hand;"/>
                        <Button text="ðŸ—‘ï¸ Vacuum Database" onAction="#handleVacuumDatabase"
                                style="-fx-padding: 10 20; -fx-cursor: hand;"/>
                    </HBox>
                </VBox>

                <Separator/>

                <!-- Danger Zone -->
                <VBox spacing="10" style="-fx-background-color: #FFF3E0; -fx-padding: 15; -fx-background-radius: 5; -fx-border-color: #FF9800; -fx-border-width: 2; -fx-border-radius: 5;">
                    <Label text="âš ï¸ Danger Zone" style="-fx-font-weight: bold; -fx-font-size: 14; -fx-text-fill: #E65100;"/>
                    <Label text="Caution: These operations are irreversible and will affect your data!"
                           wrapText="true" style="-fx-text-fill: #F57C00;"/>
                    <HBox spacing="10">
                        <Button text="ðŸ—‘ï¸ Purge All Data" onAction="#handlePurgeDatabase"
                                style="-fx-background-color: #F44336; -fx-text-fill: white; -fx-padding: 10 20; -fx-cursor: hand; -fx-font-weight: bold;"/>
                        <Button text="ðŸ”„ Reset to Defaults" onAction="#handleResetDatabase"
                                style="-fx-background-color: #FF5722; -fx-text-fill: white; -fx-padding: 10 20; -fx-cursor: hand;"/>
                    </HBox>
                </VBox>
            </VBox>

            <!-- Quick Actions Card -->
            <VBox spacing="15" styleClass="card"
                  style="-fx-background-color: #E3F2FD; -fx-background-radius: 8; -fx-padding: 20; -fx-border-color: #2196F3; -fx-border-width: 2; -fx-border-radius: 8;">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <Label text="âš¡" style="-fx-font-size: 20;"/>
                    <Label text="Quick Actions" styleClass="section-title"
                           style="-fx-font-size: 18; -fx-font-weight: bold;"/>
                </HBox>

                <Separator/>

                <HBox spacing="10" wrap="true">
                    <Button text="ðŸ”„ Refresh Connection Info" onAction="#handleRefreshInfo"
                            style="-fx-padding: 10 20; -fx-cursor: hand;"/>
                    <Button text="ðŸ“ Export DB Schema" onAction="#handleExportSchema"
                            style="-fx-padding: 10 20; -fx-cursor: hand;"/>
                    <Button text="ðŸ“¥ Import SQL File" onAction="#handleImportSQL"
                            style="-fx-padding: 10 20; -fx-cursor: hand;"/>
                    <Button text="ðŸ“– View Documentation" onAction="#handleViewDocumentation"
                            style="-fx-padding: 10 20; -fx-cursor: hand;"/>
                </HBox>
            </VBox>

        </VBox>
    </ScrollPane>

</VBox>
