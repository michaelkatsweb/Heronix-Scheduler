<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<VBox xmlns="http://javafx.com/javafx"
      xmlns:fx="http://javafx.com/fxml"
      fx:controller="com.eduscheduler.ui.controller.ColumnMappingController"
      prefWidth="800" prefHeight="600"
      spacing="15"
      styleClass="dialog-root">

    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <!-- Header -->
    <VBox spacing="5">
        <Label text="Column Mapping" styleClass="dialog-title">
            <font>
                <Font name="System Bold" size="18"/>
            </font>
        </Label>
        <Label text="Map CSV columns to database fields" styleClass="dialog-subtitle">
            <font>
                <Font size="12"/>
            </font>
        </Label>
    </VBox>

    <Separator/>

    <!-- File Information -->
    <HBox spacing="10" alignment="CENTER_LEFT">
        <Label text="ðŸ“„ File:" style="-fx-font-weight: bold;"/>
        <Label fx:id="fileNameLabel" text="No file selected" style="-fx-text-fill: #666;"/>
        <Label text="|" style="-fx-text-fill: #ccc;"/>
        <Label text="Entity Type:" style="-fx-font-weight: bold;"/>
        <Label fx:id="entityTypeLabel" text="Unknown" style="-fx-text-fill: #666;"/>
    </HBox>

    <!-- Template Selection -->
    <HBox spacing="10" alignment="CENTER_LEFT">
        <Label text="Quick Templates:"/>
        <Button fx:id="skywardTemplateBtn" text="Skyward" onAction="#applySkywardTemplate" prefWidth="100"/>
        <Button fx:id="powerSchoolTemplateBtn" text="PowerSchool" onAction="#applyPowerSchoolTemplate" prefWidth="100"/>
        <Button fx:id="customTemplateBtn" text="Custom" onAction="#applyCustomTemplate" prefWidth="100"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Button fx:id="autoDetectBtn" text="ðŸ” Auto-Detect" onAction="#autoDetectMapping" style="-fx-background-color: #2196F3; -fx-text-fill: white;"/>
    </HBox>

    <Separator/>

    <!-- Mapping Table -->
    <VBox VBox.vgrow="ALWAYS" spacing="5">
        <Label text="Column Mappings:" style="-fx-font-weight: bold;"/>

        <TableView fx:id="mappingTable" VBox.vgrow="ALWAYS">
            <columns>
                <!-- CSV Column -->
                <TableColumn fx:id="csvColumnCol" text="CSV Column" prefWidth="200" editable="false"/>

                <!-- Database Field -->
                <TableColumn fx:id="dbFieldCol" text="Database Field" prefWidth="200" editable="true"/>

                <!-- Sample Data -->
                <TableColumn fx:id="sampleDataCol" text="Sample Data (First 3 rows)" prefWidth="300" editable="false"/>

                <!-- Status -->
                <TableColumn fx:id="statusCol" text="Status" prefWidth="100" editable="false"/>
            </columns>

            <placeholder>
                <Label text="No CSV file loaded. Please select a file to begin mapping."/>
            </placeholder>
        </TableView>
    </VBox>

    <!-- Mapping Statistics -->
    <HBox spacing="20" style="-fx-background-color: #f5f5f5; -fx-padding: 10; -fx-background-radius: 5;">
        <VBox spacing="5">
            <Label text="Mapping Statistics" style="-fx-font-weight: bold;"/>
            <HBox spacing="15">
                <Label fx:id="totalColumnsLabel" text="Total Columns: 0"/>
                <Label fx:id="mappedColumnsLabel" text="Mapped: 0" style="-fx-text-fill: #4CAF50;"/>
                <Label fx:id="unmappedColumnsLabel" text="Unmapped: 0" style="-fx-text-fill: #FF9800;"/>
                <Label fx:id="requiredFieldsLabel" text="Required Fields: 0/0" style="-fx-text-fill: #2196F3;"/>
            </HBox>
        </VBox>
    </HBox>

    <!-- Validation Messages -->
    <VBox fx:id="validationBox" spacing="5" style="-fx-background-color: #fff3cd; -fx-padding: 10; -fx-background-radius: 5;" managed="false" visible="false">
        <HBox spacing="5" alignment="CENTER_LEFT">
            <Label text="âš " style="-fx-font-size: 16; -fx-text-fill: #ff9800;"/>
            <Label text="Validation Issues:" style="-fx-font-weight: bold;"/>
        </HBox>
        <TextArea fx:id="validationTextArea" editable="false" prefRowCount="3" wrapText="true"/>
    </VBox>

    <!-- Action Buttons -->
    <HBox spacing="10" alignment="CENTER_RIGHT">
        <Button fx:id="resetButton" text="Reset Mapping" onAction="#handleReset" prefWidth="120"/>
        <Button fx:id="validateButton" text="Validate Mapping" onAction="#handleValidate" prefWidth="120" style="-fx-background-color: #2196F3; -fx-text-fill: white;"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Button fx:id="cancelButton" text="Cancel" onAction="#handleCancel" prefWidth="100"/>
        <Button fx:id="saveButton" text="Save &amp; Continue" onAction="#handleSave" prefWidth="120" style="-fx-background-color: #4CAF50; -fx-text-fill: white;" disable="true"/>
    </HBox>

</VBox>
